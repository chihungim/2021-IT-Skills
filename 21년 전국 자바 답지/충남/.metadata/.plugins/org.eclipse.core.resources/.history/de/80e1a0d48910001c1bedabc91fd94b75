package view;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.text.DecimalFormat;

import javax.swing.BorderFactory;
import javax.swing.JLabel;
import javax.swing.JPanel;

public class Purchase extends BaseFrame {
	String cap_w[] = "공연명,장소,날짜,좌석,총금액".split(",");
	String cap_e[] = { pinfo[1], pinfo[3], pinfo[6], "", new DecimalFormat("#,##0").format(Stage.sum) };
	String bcap[] = "결제하기,취소".split(",");
	static int height = 320;
	JLabel check;

	public Purchase(String seats, String discounts) {
		super("결제", 300, height);
		var title = lbl("결제", JLabel.CENTER, 30);
		var c = new JPanel(new FlowLayout(FlowLayout.LEFT));
		var s = new JPanel(new GridLayout(1, 0, 5, 5));
		var c_s = new JPanel(new FlowLayout(FlowLayout.LEFT));
		add(title, "North");
		add(c);
		for (int i = 0; i < cap_w.length; i++) {
			if (i != 3) {
				var tmp = new JPanel(new BorderLayout());
				c.add(sz(tmp, 270, 30));
				tmp.add(lbl(cap_w[i], JLabel.LEFT));
				tmp.add(lbl(cap_e[i], JLabel.RIGHT), "East");
			} else {
				var tmp = new JPanel(new BorderLayout());
				var tmp_c = new JPanel(new GridLayout(0, 1));
				tmp.add(lbl(cap_w[i], JLabel.LEFT), "West");
				tmp.add(tmp_c);
				for (int j = 0; j < seats.split("#").length; j++) {
					tmp_c.add(lbl(seats.split("#")[j], JLabel.RIGHT));
				}
				c.add(sz(tmp, 270, seats.split("#").length * 20));
				tmp.setBorder(BorderFactory.createMatteBorder(1, 0, 1, 0, Color.lightGray));
			}

		}
		c.add(c_s, "South");

		c_s.add(check = lbl("", JLabel.CENTER));

		for (String bc : bcap) {
			s.add(btn(bc, a -> {
				if (a.getActionCommand().equals("결제하기")) {
					if (!check.getText().equals("V")) {
						eMsg("본인인증을 해주세요.");
						return;
					}

					iMsg("결제가 완료되었습니다.");

					execute("insert ticket values(0," + uno + "," + pinfo[0] + ",'" + seats + "','" + discounts + "')");

					for (var f : getFrames()) {
						if (f instanceof Main) {
							f.setVisible(true);
							f.addWindowListener(new Before(this));
						}
					}
				} else {
					dispose();
				}
			}));
		}

		add(s, "South");
		setVisible(true);
	}
}