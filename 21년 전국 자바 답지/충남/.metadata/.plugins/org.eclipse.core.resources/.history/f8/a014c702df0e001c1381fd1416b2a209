package view;

import java.awt.Color;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.sql.SQLException;

import javax.swing.JPanel;

public class Chart extends BaseFrame {
	Color col[] = { Color.BLACK, Color.BLUE, Color.RED, Color.green, Color.YELLOW };

	public Chart() {
		super("놀이기구 인기순위 TOP5", 850, 450);
		ui();
		setVisible(true);
	}

	void ui() {
		var c = new JPanel() {
			@Override
			protected void paintComponent(Graphics g) {
				super.paintComponent(g);
				var g2 = (Graphics2D) g;
				int idx = 0, max = 0, h = 50;
				double p = 250;
				try {
					var rs = stmt.executeQuery(
							"SELECT r.r_name, count(r.r_no) from ticket t, ride r where t.r_no=r.r_no group by r.r_no order by count(r.r_no) desc limit 5");
					while (rs.next()) {
						max = idx == 0 ? rs.getInt(1) : max;
						g2.setColor(col[idx]);
						g2.fillRect(80 + (100 * idx), 280 - (int) (p * (rs.getDouble(2) / max)), 40,
								(int) (p * (rs.getDouble(2) / max)));
						FontMetrics m = g2.getFontMetrics(g2.getFont());
						var width = m.stringWidth(rs.getString(1));

						g2.setColor(Color.BLACK);
						g2.drawRect(80 + (100 * idx), 280 - (int) (p * rs.getInt(2) / max), 40,
								(int) (p * rs.getInt(2) / max));
						g2.drawString(rs.getString(1), 100 + (100 * idx) - width / 2, 300);
						g2.drawString(rs.getString(1) + " : " + rs.getString(2) + "개", 620, 160 + (25 * idx));

						idx++;
					}
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		};

		add(lbl("놀이기구 인기순위 TOP5", 0, 25), "North");
		add(c);
		c.setOpaque(false);
	}

	public static void main(String[] args) {
		new Chart();
	}
}
